@{
    ViewBag.Title = "Index";
}

@if (this.IsAjax)
{
    Layout = "";
}

<div role="tabpanel">

  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#monitoring" aria-controls="monitoring" role="tab" data-toggle="tab">Мониторинг</a></li>
    <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Profile</a></li>
    <li role="presentation"><a href="#datavalues" aria-controls="datavalues" role="tab" data-toggle="tab">Измерения</a></li>
    <li role="presentation"><a href="#params" aria-controls="params" role="tab" data-toggle="tab">Параметры</a></li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="monitoring"><div id="monitoring_result"></div></div>
    <div role="tabpanel" class="tab-pane" id="profile">...</div>
    <div role="tabpanel" class="tab-pane" id="datavalues">
        <div id="sandbox-container">
            <div class="input-daterange input-group" id="datepicker">
                <span class="input-group-addon">Начало периода:</span>
                <input id="datepicker_start" type="text" value="@(ViewBag.DateBgn)" class="input-sm form-control" name="start" />
                <span class="input-group-addon">Конец периода:</span>
                <input id="datepicker_end" type="text" value="@(ViewBag.DateEnd)" class="input-sm form-control" name="end" />                
            </div>            
        </div>
        <script type="text/javascript">
            $(document).ready(function () {

                $('#sandbox-container .input-daterange').datepicker({
                    todayBtn: true,
                    clearBtn: true,
                    language: "ru",
                    calendarWeeks: true,
                    autoclose: true,
                    todayHighlight: true,

            
             });

             
             $('#sandbox-container .input-daterange').datepicker()
                             .on('show', function (ev) {
                        ev.stopPropagation();
                    })
                    .on('changeDate', function (ev, date) {                        
                        
                        if ($("#flag").val() == 1) {
                         
                         LoadDataValues( $("#main_site_id").val() );

                         $("#flag").val("0");
                         
                        } else {
                        $("#flag").val("1");
                        }
                        
                        
                        ev.stopPropagation();
                    });
                   


             });

             
    </script>
        <div id="datavalues_result"></div>
    </div>
    <div role="tabpanel" class="tab-pane" id="params"><div id="params_result"></div></div>
  </div>

</div>



<script type="text/javascript">

    function LoadParams(SiteId) {
        var param = { siteid: SiteId };
        
        $.ajax({
            cache: false,
            url: '@Url.Action("GetSiteParams", "Ajax")',
            data: param,
            success: function (data) {
                document.getElementById("params_result").innerHTML = data;
            },
            error: function (x, e, thrownError) {
                document.getElementById("params_result").innerHTML = '<p>Ошибка запроса</p><p>' + thrownError + '</p>';
            }
        });

        document.getElementById("params_result").innerHTML = "Загрузка";
    }

    function LoadDataValues(SiteId) {
        var param = { siteid: SiteId, date_start: $("#datepicker_start").val(), date_end: $("#datepicker_end").val() };
        
        $.ajax({
            cache: false,
            url: '@Url.Action("GetDataValues", "Ajax")',
            data: param,
            success: function (data) {
                document.getElementById("datavalues_result").innerHTML = data;
                //$('#jqxTabsDataValues').jqxTabs({ width: '100%', height: '100%', position: 'top' });
            },
            error: function (x, e, thrownError) {
                document.getElementById("datavalues_result").innerHTML = '<p>Ошибка запроса</p><p>' + thrownError + '</p>';                
            }
        });

        document.getElementById("datavalues_result").innerHTML = "Загрузка";
    }

    function LoadMonitoring(SiteId) {
        var param = { siteid: SiteId };
        $.ajax({
            cache: false,
            url: '@Url.Action("GetMonitoring", "Ajax")',
            data: param,
            success: function (data) {
                //document.getElementById("monitoring_result").innerHTML = data;



                $('#monitoring_result').highcharts({
                    title: {
                        text: 'Monthly Average Temperature',
                        x: -20 //center
                    },
                    subtitle: {
                        text: 'Source: WorldClimate.com',
                        x: -20
                    },
                    xAxis: {
                        categories: data[1]
                    },
                    yAxis: {
                        title: {
                            text: 'Temperature (°C)'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    },
                    tooltip: {
                        valueSuffix: '°C'
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'middle',
                        borderWidth: 0
                    },
                    series: [{
                        name: 'Tokyo',
                        data: data[0]
                    }, {
                        name: 'New York',
                        data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]
                    }, {
                        name: 'Berlin',
                        data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]
                    }, {
                        name: 'London',
                        data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
                    }]
                });



            },
            error: function (x, e, thrownError) {
                document.getElementById("monitoring_result").innerHTML = '<p>Ошибка запроса</p><p>' + thrownError + '</p>';
            }
        });

        document.getElementById("datavalues_result").innerHTML = "Загрузка";
    }
</script>
